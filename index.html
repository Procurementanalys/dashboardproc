<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”¥ Dashboard Terpadu - 3 in 1</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== GLOBAL VARIABLES ===== */
        :root {
            --primary-color: #2563EB;
            --primary-dark: #1E40AF;
            --primary-light: #3B82F6;
            --secondary-color: #F97316;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
            --dark-color: #1F2937;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* ===== GLOBAL RESET ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        /* Dynamic Background based on Active Tab */
        body.sales-active {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        body.procurement-active {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #3b82f6 100%);
        }

        body.sla-active {
            background: linear-gradient(135deg, #2563EB 0%, #F97316 100%);
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* ===== TAB NAVIGATION - 3 TABS ===== */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            position: sticky;
            top: 20px;
            z-index: 1000;
        }

        .tab-button {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            border: none;
            border-radius: 12px;
            padding: 15px 35px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .tab-button:hover::before {
            left: 100%;
        }

        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .tab-button i {
            font-size: 18px;
        }

        /* Sales Button Active - KAIZEN Theme */
        .tab-button.active.sales-tab {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
            transform: scale(1.05);
        }

        /* Procurement Button Active - Blue Theme */
        .tab-button.active.procurement-tab {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            transform: scale(1.05);
        }

        /* SLA Button Active - Orange/Blue Theme */
        .tab-button.active.sla-tab {
            background: linear-gradient(135deg, #2563EB 0%, #F97316 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            transform: scale(1.05);
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== SALES DASHBOARD STYLES (KAIZEN THEME) ===== */
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 35px;
            animation: fadeInDown 0.8s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Kaizen Banner */
        .kaizen-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #f06595 100%);
            border-radius: 16px;
            padding: 28px 35px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 32px rgba(238, 90, 111, 0.4);
            animation: fadeInAnim 1s ease;
            position: relative;
            overflow: hidden;
        }

        .kaizen-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 8s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInAnim {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .kaizen-banner h2 {
            font-size: 2.2em;
            margin-bottom: 12px;
            font-weight: 800;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .kaizen-banner p {
            font-size: 1.4em;
            opacity: 0.98;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Metrics Grid - 4 KOLOM */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 32px 28px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease;
            border-left: 5px solid #667eea;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .metric-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }

        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }

        .metric-label {
            color: #64748b;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 8px;
            line-height: 1.3;
            word-wrap: normal;
            overflow-wrap: normal;
            white-space: nowrap;
            overflow: visible;
            display: inline-block;
            max-width: 100%;
        }

        .metric-value-wrapper {
            overflow-x: auto;
            overflow-y: visible;
            padding: 5px 0;
            margin: 5px 0;
            -webkit-overflow-scrolling: touch;
        }

        .metric-value-wrapper::-webkit-scrollbar {
            height: 4px;
        }

        .metric-value-wrapper::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 2px;
        }

        .metric-value-wrapper::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .metric-subtitle {
            color: #94a3b8;
            font-size: 0.9em;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .trend-indicator {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-up {
            background: #dcfce7;
            color: #16a34a;
        }

        .trend-down {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Progress Card */
        .progress-card {
            background: white;
            border-radius: 16px;
            padding: 36px 32px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease;
            border-left: 5px solid #f59e0b;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .progress-main-value {
            font-size: 4em;
            font-weight: 800;
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 50%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            display: inline-block;
            white-space: nowrap;
        }

        .achievement-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            padding: 14px 28px;
            border-radius: 24px;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 6px 24px rgba(245, 158, 11, 0.6);
            }
        }

        .progress-bar-container {
            width: 100%;
            height: 32px;
            background: #f1f5f9;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 28px;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.08);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b 0%, #dc2626 50%, #7c3aed 100%);
            border-radius: 16px;
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
            background-size: 200% 100%;
            animation: progressShine 3s linear infinite;
        }

        @keyframes progressShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Quote Kaizen */
        .kaizen-quote {
            background: linear-gradient(135deg, #7c3aed 0%, #c026d3 100%);
            border-radius: 16px;
            padding: 28px 32px;
            margin: 24px 0;
            text-align: center;
            color: white;
            font-style: italic;
            font-size: 1.3em;
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.3);
            font-weight: 600;
            letter-spacing: 0.5px;
            animation: fadeInAnim 1.2s ease;
        }

        /* Incentive Milestones */
        .incentive-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 18px;
            margin-top: 28px;
        }

        .incentive-card {
            background: #f8fafc;
            border-radius: 16px;
            padding: 26px 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 3px solid #e2e8f0;
            position: relative;
        }

        .incentive-card.achieved {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-color: #22c55e;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.25);
            animation: celebration 0.6s ease;
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05) rotate(2deg); }
            75% { transform: scale(1.05) rotate(-2deg); }
        }

        .incentive-card.active {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #f59e0b;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
            }
            50% { 
                box-shadow: 0 8px 32px rgba(245, 158, 11, 0.6);
            }
        }

        .incentive-icon {
            font-size: 3.2em;
            margin-bottom: 12px;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .incentive-title {
            font-size: 1.5em;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .incentive-target {
            font-size: 0.95em;
            color: #64748b;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .incentive-status {
            font-weight: 700;
            padding: 8px 18px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-achieved {
            background: #22c55e;
            color: white;
        }

        .status-progress {
            background: #f59e0b;
            color: white;
        }

        .status-locked {
            background: #cbd5e1;
            color: #64748b;
        }

        .incentive-mini-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.08);
            border-radius: 6px;
            margin-top: 14px;
            overflow: hidden;
        }

        .incentive-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #dc2626);
            border-radius: 6px;
            transition: width 1.2s ease;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 16px;
            padding: 32px 28px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            animation: fadeInUp 1s ease;
            border-left: 5px solid #22c55e;
        }

        .chart-title {
            font-size: 1.6em;
            color: #1e293b;
            margin-bottom: 26px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .top-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 12px;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.25s ease;
        }

        .top-item:hover {
            background: #f8fafc;
            padding-left: 20px;
            border-radius: 10px;
            transform: translateX(4px);
        }

        .top-item:last-child {
            border-bottom: none;
        }

        .top-item-rank {
            font-weight: 800;
            color: #667eea;
            margin-right: 16px;
            font-size: 1.4em;
            min-width: 45px;
        }

        .top-item-name {
            flex: 1;
            color: #334155;
            font-weight: 600;
            font-size: 1.05em;
        }

        .top-item-value {
            font-weight: 800;
            color: #1e293b;
            font-size: 1.05em;
            margin-left: 16px;
            white-space: nowrap;
            overflow: visible;
            padding-left: 10px;
        }

        .top-item-bar {
            width: 100%;
            height: 10px;
            background: #f1f5f9;
            border-radius: 6px;
            margin-top: 10px;
            overflow: hidden;
        }

        .top-item-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            border-radius: 6px;
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Medal colors for top 3 */
        .top-item:nth-child(1) .top-item-rank {
            color: #f59e0b;
            font-size: 1.8em;
        }

        .top-item:nth-child(2) .top-item-rank {
            color: #94a3b8;
            font-size: 1.7em;
        }

        .top-item:nth-child(3) .top-item-rank {
            color: #d97706;
            font-size: 1.6em;
        }

        /* Refresh Button */
        .refresh-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 18px 42px;
            border-radius: 28px;
            font-size: 1.1em;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .refresh-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.5);
        }

        .refresh-btn:active {
            transform: translateY(-2px);
        }

        /* Loading & Error States */
        .loading {
            text-align: center;
            color: white;
            font-size: 2em;
            padding: 60px;
            font-weight: 700;
            animation: loadingPulse 1.5s infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
            border: 2px solid #fee2e2;
        }

        .last-update {
            text-align: center;
            color: white;
            opacity: 0.9;
            font-size: 0.95em;
            margin-top: 24px;
            font-weight: 500;
        }

        /* ===== PROCUREMENT DASHBOARD STYLES (BLUE THEME) ===== */
        .procurement-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px 45px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            margin-bottom: 35px;
            border: 2px solid rgba(37, 99, 235, 0.2);
            position: relative;
            overflow: hidden;
        }

        .procurement-header::before {
            content: 'ðŸ“¦';
            position: absolute;
            font-size: 18em;
            opacity: 0.04;
            right: -40px;
            top: -50px;
            transform: rotate(15deg);
            animation: floatIcon 6s ease-in-out infinite;
        }

        @keyframes floatIcon {
            0%, 100% { transform: rotate(15deg) translateY(0); }
            50% { transform: rotate(15deg) translateY(-20px); }
        }

        .procurement-title {
            text-align: center;
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 18px;
            letter-spacing: -0.8px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
        }

        .procurement-subtitle {
            text-align: center;
            color: #1e40af;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 2.5px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 18px;
            margin-top: 28px;
            flex-wrap: wrap;
        }

        select {
            padding: 14px 24px;
            border-radius: 14px;
            border: 3px solid #bfdbfe;
            font-size: 15px;
            background: white;
            color: #1e3a8a;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            min-width: 220px;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        select:hover {
            border-color: #2563eb;
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25);
            transform: translateY(-2px);
        }

        select:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 5px rgba(37, 99, 235, 0.15);
        }

        .procurement-btn {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 14px 32px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.35);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .procurement-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }

        .procurement-btn:hover::before {
            left: 100%;
        }

        .procurement-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.45);
        }

        .procurement-btn:active {
            transform: translateY(-1px);
        }

        #lastUpdated {
            text-align: center;
            font-size: 14px;
            color: #1e40af;
            margin-top: 18px;
            font-weight: 700;
            padding: 10px 20px;
            background: rgba(37, 99, 235, 0.12);
            border-radius: 24px;
            display: inline-block;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15);
        }

        /* Table Container - Procurement Theme */
        .procurement-table-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            margin-bottom: 35px;
            border: 2px solid rgba(37, 99, 235, 0.2);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 0;
            background: transparent;
            border-radius: 0;
            overflow: hidden;
            box-shadow: none;
        }

        th, td {
            padding: 18px 22px;
            text-align: center;
            border-bottom: 2px solid #bfdbfe;
        }

        th {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }

        th:first-child {
            border-radius: 14px 0 0 0;
        }

        th:last-child {
            border-radius: 0 14px 0 0;
        }

        td {
            font-size: 14.5px;
            font-weight: 600;
            color: #1e3a8a;
        }

        tbody tr {
            transition: all 0.3s ease;
            background: white;
        }

        tbody tr:hover {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.08) 0%, rgba(30, 64, 175, 0.08) 100%);
            transform: scale(1.015);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.2);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* GRAND TOTAL ROW STYLING */
        tbody tr.grand-total-row {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15) 0%, rgba(30, 64, 175, 0.15) 100%) !important;
            border-top: 3px solid #2563eb;
            border-bottom: 3px solid #2563eb;
        }

        tbody tr.grand-total-row td {
            font-weight: 900 !important;
            font-size: 16px !important;
            color: #1e40af !important;
            padding: 22px 22px !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tbody tr.grand-total-row:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2) 0%, rgba(30, 64, 175, 0.2) 100%) !important;
            transform: scale(1.02);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
        }

        .status-ok { 
            color: #2563eb; 
            font-weight: 800;
            background: rgba(37, 99, 235, 0.18);
            padding: 8px 16px;
            border-radius: 24px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }

        .status-over { 
            color: #dc2626; 
            font-weight: 800;
            background: rgba(220, 38, 38, 0.15);
            padding: 8px 16px;
            border-radius: 24px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }

        /* Chart Container - Procurement Theme */
        .procurement-chart-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            margin-bottom: 35px;
            border: 2px solid rgba(37, 99, 235, 0.2);
        }

        .procurement-chart-title {
            text-align: center;
            color: #1e40af;
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        canvas {
            margin-top: 20px;
            max-height: 350px !important;
        }

        /* ===== SLA & SOH DASHBOARD STYLES (ORANGE/BLUE THEME) ===== */
        .header-card {
            background: white;
            border-radius: 24px;
            padding: 35px 40px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-2xl);
            animation: slideDown 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .header-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #2563EB, #F97316, #10B981);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #2563EB, #F97316);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
            animation: pulse 2s infinite;
        }

        .header-text h1 {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #2563EB, #F97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header-text p {
            color: var(--gray-600);
            font-size: 15px;
            font-weight: 500;
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            color: var(--gray-600);
            font-size: 14px;
        }

        .header-meta i {
            color: var(--primary-color);
        }

        /* API STATUS BADGE */
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }

        .api-status.connected {
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            color: #065F46;
        }

        .api-status.disconnected {
            background: linear-gradient(135deg, #FEE2E2, #FECACA);
            color: #991B1B;
        }

        .api-status.checking {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            color: #92400E;
        }

        .api-status i {
            font-size: 11px;
        }

        /* SUB TAB NAVIGATION (for SLA & SOH) */
        .sub-tab-navigation {
            background: white;
            border-radius: 20px;
            padding: 10px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s ease-out;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sub-tab-btn {
            flex: 1;
            min-width: 200px;
            padding: 18px 30px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: 'Inter', sans-serif;
            background: transparent;
            color: var(--gray-600);
            position: relative;
            overflow: hidden;
        }

        .sub-tab-btn i {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .sub-tab-btn:hover {
            background: var(--gray-50);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .sub-tab-btn:hover i {
            transform: scale(1.2) rotate(5deg);
        }

        .sub-tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
            transform: translateY(-2px);
        }

        .sub-tab-btn.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .sub-tab-btn.active i {
            transform: scale(1.1);
        }

        /* FILTER SECTION */
        .filter-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s ease-out;
            transition: all 0.3s ease;
        }

        .filter-card:hover {
            box-shadow: var(--shadow-xl);
        }

        .filter-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 18px;
            border-bottom: 3px solid var(--gray-100);
        }

        .filter-header i {
            color: var(--primary-color);
            font-size: 22px;
        }

        .filter-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-color);
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label i {
            color: var(--primary-color);
            font-size: 14px;
        }

        .filter-input {
            padding: 14px 18px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            transform: translateY(-1px);
        }

        .filter-input:hover {
            border-color: var(--primary-light);
        }

        select.filter-input {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232563EB' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 45px;
            background-color: var(--gray-50);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: 'Inter', sans-serif;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: 0 6px 15px rgba(37, 99, 235, 0.35);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-300);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--gray-400);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.35);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.45);
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 28px;
            box-shadow: var(--shadow-md);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: scaleIn 0.5s ease-out;
            animation-fill-mode: backwards;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-2xl);
        }

        .stat-card.warning .stat-value {
            color: var(--danger-color);
            animation: pulseValue 2s infinite;
        }

        @keyframes pulseValue {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 18px;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            transition: transform 0.3s ease;
        }

        .stat-card:hover .stat-icon {
            transform: rotate(10deg) scale(1.1);
        }

        .stat-icon.green {
            background: linear-gradient(135deg, #10B981, #059669);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.35);
        }

        .stat-icon.blue {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.35);
        }

        .stat-icon.yellow {
            background: linear-gradient(135deg, #F97316, #EA580C);
            box-shadow: 0 6px 15px rgba(249, 115, 22, 0.35);
        }

        .stat-icon.red {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            box-shadow: 0 6px 15px rgba(239, 68, 68, 0.35);
        }

        .stat-value {
            font-size: 34px;
            font-weight: 800;
            color: var(--dark-color);
            margin-bottom: 8px;
            line-height: 1.1;
        }

        .stat-value.currency {
            font-size: 26px;
        }

        .stat-footer {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--gray-600);
        }

        .stat-footer i {
            color: var(--success-color);
        }

        /* TABLE SECTION */
        .table-card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 1s ease-out;
            transition: all 0.3s ease;
        }

        .table-card:hover {
            box-shadow: var(--shadow-xl);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .table-title {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .table-title i {
            font-size: 26px;
            color: var(--primary-color);
        }

        .table-title h3 {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark-color);
        }

        .table-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 12px 45px 12px 18px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 14px;
            width: 300px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            width: 350px;
        }

        .search-box i {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            font-size: 16px;
        }

        .section-badge {
            padding: 10px 22px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 14px;
            border: 2px solid var(--gray-200);
        }

        thead {
            background: linear-gradient(135deg, #2563EB, #F97316);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th.sortable:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        th.sortable::after {
            content: '\f0dc';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 10px;
            opacity: 0.4;
            font-size: 12px;
        }

        th.sortable.asc::after {
            content: '\f0de';
            opacity: 1;
        }

        th.sortable.desc::after {
            content: '\f0dd';
            opacity: 1;
        }

        tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: linear-gradient(90deg, #F9FAFB, #F3F4F6);
            transform: scale(1.01);
        }

        .table-number {
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
        }

        .table-supplier, .table-sku {
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-contract {
            color: var(--gray-600);
            font-size: 13px;
        }

        .table-amount {
            font-weight: 700;
            color: var(--dark-color);
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .sla-badge {
            display: inline-block;
            padding: 7px 16px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 13px;
            text-align: center;
            min-width: 70px;
            box-shadow: var(--shadow-sm);
        }

        .sla-excellent {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }

        .sla-good {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
        }

        .sla-poor {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }

        .location-badge, .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 18px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }

        .location-store {
            background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
            color: #1E40AF;
        }

        .location-apd {
            background: linear-gradient(135deg, #FED7AA, #FDBA74);
            color: #C2410C;
        }

        .status-active {
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            color: #065F46;
        }

        .status-hold {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            color: #A16207;
        }

        .status-discontinue {
            background: linear-gradient(135deg, #FEE2E2, #FECACA);
            color: #991B1B;
        }

        .status-other {
            background: linear-gradient(135deg, #E2E8F0, #CBD5E1);
            color: #475569;
        }

        /* LOADING */
        .spinner {
            border: 5px solid var(--gray-200);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray-600);
            font-weight: 600;
            font-size: 18px;
        }

        /* ERROR */
        .error-message {
            background: linear-gradient(135deg, #FEE2E2, #FECACA);
            border: 2px solid #EF4444;
            color: #991B1B;
            padding: 25px;
            border-radius: 14px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
        }

        .error-message i {
            font-size: 26px;
            color: #EF4444;
            flex-shrink: 0;
        }

        .error-details {
            flex: 1;
        }

        .error-details h4 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .error-details p {
            font-size: 14px;
            font-weight: 400;
            line-height: 1.7;
        }

        .error-details code {
            background: rgba(0,0,0,0.1);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state i {
            font-size: 72px;
            color: var(--gray-300);
            margin-bottom: 25px;
        }

        .empty-state h3 {
            font-size: 22px;
            font-weight: 700;
            color: var(--gray-600);
            margin-bottom: 12px;
        }

        .empty-state p {
            color: var(--gray-600);
            font-size: 15px;
        }

        .no-data {
            text-align: center;
            padding: 80px 20px;
            color: #94A3B8;
            font-size: 18px;
        }

        .no-data i {
            font-size: 72px;
            display: block;
            margin-bottom: 25px;
            color: #CBD5E1;
        }

        footer {
            text-align: center;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.98);
            margin-top: 45px;
            padding: 22px;
            font-weight: 700;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1400px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .incentive-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .incentive-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .tab-button {
                padding: 12px 20px;
                font-size: 13px;
            }

            .header h1, .procurement-title, .header-text h1 {
                font-size: 24px;
            }

            .header-card {
                padding: 25px;
            }

            .header-icon {
                width: 55px;
                height: 55px;
                font-size: 26px;
            }

            .sub-tab-btn {
                min-width: 100%;
            }
            
            .metric-value {
                font-size: 1.6em;
            }

            .progress-main-value {
                font-size: 3em;
            }

            .incentive-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .progress-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .achievement-badge {
                font-size: 1em;
                padding: 12px 24px;
            }

            .procurement-header {
                padding: 25px 20px;
            }

            .controls {
                flex-direction: column;
                gap: 12px;
            }

            select, .procurement-btn {
                width: 100%;
                max-width: 300px;
            }

            th, td {
                padding: 12px 10px;
                font-size: 12px;
            }

            .procurement-table-container, .procurement-chart-container {
                padding: 20px 15px;
            }

            .filter-controls {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-box input {
                width: 100%;
            }

            .search-box input:focus {
                width: 100%;
            }

            .table-actions {
                width: 100%;
                flex-direction: column;
            }

            .table-wrapper {
                overflow-x: scroll;
            }

            table {
                min-width: 800px;
            }
        }

        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        /* Sales Theme Scrollbar */
        body.sales-active ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            border-radius: 10px;
        }

        body.sales-active ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #dc2626 0%, #f59e0b 100%);
        }

        /* Procurement Theme Scrollbar */
        body.procurement-active ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            border-radius: 10px;
        }

        body.procurement-active ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
        }

        /* SLA Theme Scrollbar */
        body.sla-active ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #2563EB 0%, #F97316 100%);
            border-radius: 10px;
        }

        body.sla-active ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #F97316 0%, #2563EB 100%);
        }

        /* UTILITY */
        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="sales-active">
    <div class="main-container">
        <!-- TAB NAVIGATION - 3 TABS -->
        <div class="tab-navigation">
            <button class="tab-button active sales-tab" onclick="switchMainTab('sales')">
                <i class="fas fa-fire"></i> DASHBOARD SALES
            </button>
            <button class="tab-button procurement-tab" onclick="switchMainTab('procurement')">
                <i class="fas fa-box"></i> DASHBOARD PROCUREMENT
            </button>
            <button class="tab-button sla-tab" onclick="switchMainTab('sla')">
                <i class="fas fa-chart-line"></i> SLA & STOCK ON HAND
            </button>
        </div>

        <!-- ========================================
             TAB 1: SALES DASHBOARD (KAIZEN THEME)
        ======================================== -->
        <div id="salesTab" class="tab-content active">
            <div class="container">
                <div class="header">
                    <h1>ðŸ”¥ DASHBOARD SALES - KAIZEN SPIRIT ðŸ”¥</h1>
                    <p>Continuous Improvement â€¢ æ”¹å–„ â€¢ Never Stop Growing</p>
                </div>

                <button class="refresh-btn" onclick="loadDashboard()">âš¡ REFRESH DATA NOW</button>

                <div id="loading" class="loading">â³ Loading data...</div>
                <div id="error" class="error" style="display: none;"></div>

                <div id="dashboard" style="display: none;">
                    <!-- Kaizen Banner -->
                    <div class="kaizen-banner" id="kaizenBanner">
                        <h2 id="kaizenTitle">ðŸ’ª SEMANGAT KAIZEN!</h2>
                        <p id="kaizenMessage">Improvement TODAY is better than perfection TOMORROW!</p>
                    </div>

                    <!-- Kaizen Quote -->
                    <div class="kaizen-quote">
                        ðŸŒŸ "æ”¹å–„ KAIZEN: Perbaikan kecil setiap hari menciptakan hasil luar biasa!" ðŸŒŸ
                    </div>

                    <!-- Main Metrics Grid - 4 KOLOM -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">ðŸŽ¯ TARGET SALES</div>
                            <div class="metric-value-wrapper">
                                <div class="metric-value" id="targetSales">Rp 0</div>
                            </div>
                            <div class="metric-subtitle">Target bulan ini</div>
                        </div>

                        <div class="metric-card" style="border-left-color: #7c3aed;">
                            <div class="metric-label">ðŸ’° TOTAL SALES</div>
                            <div class="metric-value-wrapper">
                                <div class="metric-value" id="totalSales" style="background: linear-gradient(135deg, #7c3aed 0%, #c026d3 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Rp 0</div>
                            </div>
                            <div class="metric-subtitle">Total penjualan keseluruhan</div>
                            <span class="trend-indicator" id="totalTrend" style="background: linear-gradient(135deg, #7c3aed 0%, #c026d3 100%); color: white;">ðŸ’Ž ACCUMULATING</span>
                        </div>

                        <div class="metric-card">
                            <div class="metric-label">âš¡ DAILY SALES</div>
                            <div class="metric-value-wrapper">
                                <div class="metric-value" id="dailySales">Rp 0</div>
                            </div>
                            <div class="metric-subtitle">Penjualan hari ini</div>
                            <span class="trend-indicator trend-up" id="dailyTrend">ðŸ“ˆ ABOVE AVERAGE</span>
                        </div>

                        <div class="metric-card">
                            <div class="metric-label">ðŸ“Š AVERAGE SALES</div>
                            <div class="metric-value-wrapper">
                                <div class="metric-value" id="avgSales">Rp 0</div>
                            </div>
                            <div class="metric-subtitle">Rata-rata per hari</div>
                        </div>
                    </div>

                    <!-- Progress Card with Milestones -->
                    <div class="progress-card">
                        <div class="progress-header">
                            <div>
                                <div class="metric-label">ðŸ”¥ PROGRESS TO TARGET</div>
                                <div class="progress-main-value" id="progressPercent">0%</div>
                                <div class="metric-subtitle" id="remainingAmount">Tersisa Rp 0</div>
                            </div>
                            <div class="achievement-badge" id="achievementBadge">
                                ðŸ† KEEP PUSHING!
                            </div>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                        </div>

                        <!-- Incentive Milestones -->
                        <div class="incentive-grid">
                            <div class="incentive-card" id="incentive30">
                                <div class="incentive-icon">ðŸ¥‰</div>
                                <div class="incentive-title">BRONZE</div>
                                <div class="incentive-target">Target: 30%</div>
                                <div class="incentive-status status-locked">ðŸ”’ LOCKED</div>
                                <div class="incentive-mini-bar">
                                    <div class="incentive-mini-fill" style="width: 0%"></div>
                                </div>
                            </div>

                            <div class="incentive-card" id="incentive50">
                                <div class="incentive-icon">ðŸ¥ˆ</div>
                                <div class="incentive-title">SILVER</div>
                                <div class="incentive-target">Target: 50%</div>
                                <div class="incentive-status status-locked">ðŸ”’ LOCKED</div>
                                <div class="incentive-mini-bar">
                                    <div class="incentive-mini-fill" style="width: 0%"></div>
                                </div>
                            </div>

                            <div class="incentive-card" id="incentive75">
                                <div class="incentive-icon">ðŸ¥‡</div>
                                <div class="incentive-title">GOLD</div>
                                <div class="incentive-target">Target: 75%</div>
                                <div class="incentive-status status-locked">ðŸ”’ LOCKED</div>
                                <div class="incentive-mini-bar">
                                    <div class="incentive-mini-fill" style="width: 0%"></div>
                                </div>
                            </div>

                            <div class="incentive-card" id="incentive100">
                                <div class="incentive-icon">ðŸ’Ž</div>
                                <div class="incentive-title">DIAMOND</div>
                                <div class="incentive-target">Target: 100%</div>
                                <div class="incentive-status status-locked">ðŸ”’ LOCKED</div>
                                <div class="incentive-mini-bar">
                                    <div class="incentive-mini-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top 10 Charts -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-title">
                                <span>ðŸ†</span> TOP 10 CATEGORY SALES
                            </div>
                            <div id="topCategories"></div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-title">
                                <span>ðŸª</span> TOP 10 STORE SALES
                            </div>
                            <div id="topStores"></div>
                        </div>
                    </div>

                    <div class="last-update">
                        â° Last updated: <span id="lastUpdate">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             TAB 2: PROCUREMENT DASHBOARD (BLUE THEME)
        ======================================== -->
        <div id="procurementTab" class="tab-content">
            <div class="container">
                <div class="procurement-header">
                    <h1 class="procurement-title">ðŸ“¦ PROCUREMENT DASHBOARD</h1>
                    <p class="procurement-subtitle">ðŸšš Strategic Budget Tracking & Management ðŸ“Š</p>

                    <div class="controls">
                        <select id="categoryFilterProc" onchange="filterCategoryProc()">
                            <option value="ALL">Semua Kategori</option>
                        </select>
                        <button class="procurement-btn" onclick="loadTracking()">
                            ðŸ”„ Refresh Data
                        </button>
                    </div>
                    <div id="lastUpdated">Terakhir update: -</div>
                </div>

                <div class="procurement-table-container">
                    <table id="trackingTable">
                        <thead>
                            <tr>
                                <th>ðŸ“‹ CATEGORY</th>
                                <th>ðŸ“ PO ISSUED</th>
                                <th>ðŸ“¦ PO RECEIVED</th>
                                <th>ðŸ’° BUDGET</th>
                                <th>ðŸ’µ SISA BUDGET</th>
                                <th>ðŸ“Š % USED</th>
                                <th>âœ… STATUS</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="procurement-chart-container">
                    <h2 class="procurement-chart-title">ðŸ“Š Budget Performance Overview</h2>
                    <canvas id="budgetChart"></canvas>
                </div>

                <footer>Â© 2025 Procurement Division - Alpro | Strategic Sourcing & Budget Management</footer>
            </div>
        </div>

        <!-- ========================================
             TAB 3: SLA & SOH DASHBOARD (ORANGE/BLUE THEME)
        ======================================== -->
        <div id="slaTab" class="tab-content">
            <div class="container">
                <!-- HEADER -->
                <div class="header-card">
                    <div class="header-content">
                        <div class="header-title">
                            <img src="logo-alpro.png" alt="Alpro Logo" style="width: 80px; height: 80px; object-fit: contain; border-radius: 12px; background: white; padding: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div class="header-text">
                                <h1>Dashboard Terpadu</h1>
                                <p>Monitoring SLA Supplier & Stock On Hand</p>
                            </div>
                        </div>
                        <div class="header-meta">
                            <span class="api-status checking" id="apiStatusGlobal">
                                <i class="fas fa-circle-notch fa-spin"></i>
                                Checking API...
                            </span>
                            <span><i class="fas fa-calendar"></i> <span id="lastUpdateGlobal">Loading...</span></span>
                        </div>
                    </div>
                </div>

                <!-- SUB TAB NAVIGATION -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-btn active" onclick="switchSubTab('sla')">
                        <i class="fas fa-chart-line"></i>
                        SLA Supplier
                    </button>
                    <button class="sub-tab-btn" onclick="switchSubTab('soh')">
                        <i class="fas fa-warehouse"></i>
                        Stock On Hand (SOH)
                    </button>
                </div>

                <!-- ===== SUB-TAB 1: SLA SUPPLIER ===== -->
                <div id="tab-sla" class="tab-content active">
                    <!-- FILTER SECTION -->
                    <div class="filter-card">
                        <div class="filter-header">
                            <i class="fas fa-filter"></i>
                            <h3>Filter Data</h3>
                        </div>

                        <div class="filter-controls">
                            <div class="filter-group">
                                <label>
                                    <i class="fas fa-layer-group"></i>
                                    Kategori Data
                                </label>
                                <select id="categoryFilter" class="filter-input">
                                    <option value="ALL">Semua Data (STORE + APD)</option>
                                    <option value="STORE">STORE (Obat & Medis)</option>
                                    <option value="APD">APD (Warehouse)</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label>
                                    <i class="fas fa-calendar-alt"></i>
                                    Tanggal Mulai (Opsional)
                                </label>
                                <input type="date" id="dateFrom" class="filter-input">
                            </div>

                            <div class="filter-group">
                                <label>
                                    <i class="fas fa-calendar-check"></i>
                                    Tanggal Selesai (Opsional)
                                </label>
                                <input type="date" id="dateTo" class="filter-input">
                            </div>
                        </div>

                        <div class="filter-actions">
                            <button class="btn btn-primary" id="btnFilter" onclick="applyFilterSLA()">
                                <i class="fas fa-search"></i>
                                Filter Data
                            </button>
                            <button class="btn btn-secondary" id="btnReset" onclick="resetFilterSLA()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                        </div>
                    </div>

                    <!-- STATS CARDS -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Total PO Issued</div>
                                    <div class="stat-value currency" id="totalPOIssued">Rp 0</div>
                                </div>
                                <div class="stat-icon green">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <i class="fas fa-arrow-up"></i>
                                <span>Purchase Order yang dikeluarkan</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Total PO Received</div>
                                    <div class="stat-value currency" id="totalPOReceived">Rp 0</div>
                                </div>
                                <div class="stat-icon blue">
                                    <i class="fas fa-box-open"></i>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <i class="fas fa-check-circle"></i>
                                <span>Purchase Order yang diterima</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Rata-rata SLA</div>
                                    <div class="stat-value" id="averageSLA">0%</div>
                                </div>
                                <div class="stat-icon yellow">
                                    <i class="fas fa-percentage"></i>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <i class="fas fa-chart-line"></i>
                                <span>Service Level Agreement</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Total Data</div>
                                    <div class="stat-value" id="totalData">0</div>
                                </div>
                                <div class="stat-icon red">
                                    <i class="fas fa-database"></i>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <i class="fas fa-list"></i>
                                <span>Jumlah supplier yang dipantau</span>
                            </div>
                        </div>
                    </div>

                    <!-- TABLE -->
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <i class="fas fa-table"></i>
                                <h3>Data Supplier</h3>
                            </div>
                            <div class="table-actions">
                                <div class="search-box">
                                    <input type="text" id="searchInputSLA" placeholder="Cari supplier atau contract..." onkeyup="searchTableSLA()">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>

                        <div id="tableContainerSLA">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div class="loading-text">Memuat data...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== SUB-TAB 2: STOCK ON HAND (SOH) ===== -->
                <div id="tab-soh" class="tab-content">
                    <!-- FILTER SECTION - Only Location -->
                    <div class="filter-card">
                        <div class="filter-header">
                            <i class="fas fa-filter"></i>
                            <h3>Filter Lokasi</h3>
                        </div>
                        
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label>
                                    <i class="fas fa-map-marker-alt"></i>
                                    Lokasi
                                </label>
                                <select id="locationFilter" class="filter-input" onchange="applyFiltersSOH()">
                                    <option value="all">Semua Lokasi</option>
                                    <option value="store">Store</option>
                                    <option value="apd">APD (Warehouse)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- SUMMARY CARDS -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Total SOH Value</div>
                                    <div class="stat-value currency" id="totalValue">Rp 0</div>
                                </div>
                                <div class="stat-icon blue">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <i class="fas fa-check-circle"></i>
                                <span>Keseluruhan lokasi</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Store SOH</div>
                                    <div class="stat-value currency" id="storeValue">Rp 0</div>
                                </div>
                                <div class="stat-icon green">
                                    <i class="fas fa-store"></i>
                                </div>
                            </div>
                            <div class="stat-footer" id="storeItems">
                                <i class="fas fa-box"></i>
                                <span>0 items</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">APD SOH</div>
                                    <div class="stat-value currency" id="apdValue">Rp 0</div>
                                </div>
                                <div class="stat-icon yellow">
                                    <i class="fas fa-warehouse"></i>
                                </div>
                            </div>
                            <div class="stat-footer" id="apdItems">
                                <i class="fas fa-box"></i>
                                <span>0 items</span>
                            </div>
                        </div>
                        
                        <div class="stat-card warning">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-label">Zero Stock Alert</div>
                                    <div class="stat-value" id="zeroStockCount">0</div>
                                </div>
                                <div class="stat-icon red">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="stat-footer" id="zeroStockSubtitle">
                                <i class="fas fa-exclamation-circle"></i>
                                <span>Active & Hold Order items</span>
                            </div>
                        </div>
                    </div>

                    <!-- ZERO STOCK ALERT SECTION -->
                    <div class="table-card">
                        <div class="table-header">
                            <div class="table-title">
                                <i class="fas fa-exclamation-circle"></i>
                                <h3>Zero Stock Items (Active & Hold Order)</h3>
                            </div>
                            <div class="table-actions">
                                <span class="section-badge" id="zeroStockBadge">0 Items</span>
                                <button class="btn btn-success" onclick="exportZeroStock()">
                                    <i class="fas fa-file-excel"></i>
                                    Export CSV
                                </button>
                            </div>
                        </div>
                        
                        <div id="zeroStockContent">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div class="loading-text">Memuat data...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL CONFIGURATION =====
        const SALES_API_URL = 'https://script.google.com/macros/s/AKfycbzCvnX2nuXGQ94sq49QHJ2nWSNOfUUG1brS9bWdNFxbtAZbRChClTdjhUeYYyFq4f8t7A/exec';
        const PROCUREMENT_API_URL = 'https://script.google.com/macros/s/AKfycbwuU0ltJswU_GW1V0qDZJNheWJDm-2_zEkXs3X_O6EZE6kUfPAKjk-l8SHT43nGUpxX/exec';
        const API_URL_SLA = 'https://script.google.com/macros/s/AKfycbwdE-WthEPNQ9QyzmHHm8IKOKPwo7wNM1MY-4qvdfJWIJb_IndWyrv4zbiH-COIcWkP/exec';
        const API_URL_SOH = 'https://script.google.com/macros/s/AKfycbzqqRXK_yQ_jM8Hi4i0nBtjXCfA1O-ojFn5t-tanwi51cuiA9RgOHwTCD0EB61S4Xa9/exec';
        
        // Procurement Variables
        let allTrackingData = [];
        let budgetChart = null;

        // SLA Variables
        let currentDataSLA = [];
        let allDataStore = [];
        let allDataAPD = [];
        let sortColumnSLA = null;
        let sortDirectionSLA = 'asc';
        let isAPIConnectedSLA = false;

        // SOH Variables
        let allDataSOH = [];
        let zeroStockData = [];
        let currentLocationFilter = 'all';
        let isAPIConnectedSOH = false;

        // ===== MAIN TAB SWITCHING =====
        function switchMainTab(tabName) {
            // Hide all main tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Remove all body classes
            document.body.classList.remove('sales-active', 'procurement-active', 'sla-active');

            // Show selected tab and update body class
            if (tabName === 'sales') {
                document.getElementById('salesTab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
                document.body.classList.add('sales-active');
                if (document.getElementById('dashboard').style.display === 'none') {
                    loadDashboard();
                }
            } else if (tabName === 'procurement') {
                document.getElementById('procurementTab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
                document.body.classList.add('procurement-active');
                loadTracking();
            } else if (tabName === 'sla') {
                document.getElementById('slaTab').classList.add('active');
                document.querySelectorAll('.tab-button')[2].classList.add('active');
                document.body.classList.add('sla-active');
                if (!isAPIConnectedSLA) {
                    checkAPIConnectionSLA();
                }
            }
        }

        // ===== SUB TAB SWITCHING (for SLA & SOH) =====
        function switchSubTab(tabName) {
            // Remove active class from all sub-tabs
            document.querySelectorAll('.sub-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('#slaTab .tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Add active class to selected tab
            event.target.classList.add('active');
            
            if (tabName === 'sla') {
                document.getElementById('tab-sla').classList.add('active');
                if (!isAPIConnectedSLA) {
                    checkAPIConnectionSLA();
                }
            } else if (tabName === 'soh') {
                document.getElementById('tab-soh').classList.add('active');
                if (!isAPIConnectedSOH) {
                    loadDashboardSOH();
                }
            }
        }

        // ========================================
        // ===== SALES DASHBOARD FUNCTIONS =====
        // ========================================

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function updateKaizenMessage(progress) {
            const banner = document.getElementById('kaizenBanner');
            const title = document.getElementById('kaizenTitle');
            const message = document.getElementById('kaizenMessage');

            if (progress >= 100) {
                title.textContent = 'ðŸŽŠ KAIZEN ACHIEVED! TARGET TERCAPAI! ðŸŽŠ';
                message.textContent = 'æ”¹å–„å®Œæˆï¼EXCELLENCE! Anda telah mencapai kesempurnaan bulan ini! ðŸ†âœ¨';
            } else if (progress >= 75) {
                title.textContent = 'ðŸ”¥ KAIZEN POWER! HAMPIR SAMPAI! ðŸ”¥';
                message.textContent = `æ”¹å–„ä¸­ï¼Tinggal ${(100 - progress).toFixed(1)}% lagi! PUSH HARDER, SUCCESS IS NEAR! ðŸ’ªðŸš€`;
            } else if (progress >= 50) {
                title.textContent = 'âš¡ KAIZEN MOMENTUM! SEPARUH JALAN! âš¡';
                message.textContent = 'æ”¹å–„é€²è¡Œä¸­ï¼Separuh perjalanan dilalui! KEEP THE FIRE BURNING! ðŸŒŸðŸ’ª';
            } else if (progress >= 30) {
                title.textContent = 'ðŸŽ¯ KAIZEN START! MOMENTUM BAGUS! ðŸŽ¯';
                message.textContent = 'æ”¹å–„é–‹å§‹ï¼Great start! Terus tingkatkan dengan semangat KAIZEN! ðŸ”¥ðŸ’«';
            } else {
                title.textContent = 'ðŸš€ SEMANGAT KAIZEN! LET\'S GO! ðŸš€';
                message.textContent = 'æ”¹å–„ç²¾ç¥žï¼Improvement TODAY is better than perfection TOMORROW! ðŸ’ªðŸŒŸ';
            }
        }

        function updateIncentiveMilestones(progress) {
            const milestones = [
                { id: 'incentive30', target: 30, icon: 'ðŸ¥‰', title: 'Bronze' },
                { id: 'incentive50', target: 50, icon: 'ðŸ¥ˆ', title: 'Silver' },
                { id: 'incentive75', target: 75, icon: 'ðŸ¥‡', title: 'Gold' },
                { id: 'incentive100', target: 100, icon: 'ðŸ’Ž', title: 'Diamond' }
            ];

            milestones.forEach(milestone => {
                const card = document.getElementById(milestone.id);
                const statusEl = card.querySelector('.incentive-status');
                const fillEl = card.querySelector('.incentive-mini-fill');

                if (progress >= milestone.target) {
                    card.classList.remove('active');
                    card.classList.add('achieved');
                    statusEl.textContent = 'âœ… ACHIEVED!';
                    statusEl.className = 'incentive-status status-achieved';
                    fillEl.style.width = '100%';
                } else if (progress >= (milestones[milestones.indexOf(milestone) - 1]?.target || 0)) {
                    card.classList.add('active');
                    card.classList.remove('achieved');
                    statusEl.textContent = `ðŸ”¥ ${progress.toFixed(1)}%`;
                    statusEl.className = 'incentive-status status-progress';
                    const prevTarget = milestones[milestones.indexOf(milestone) - 1]?.target || 0;
                    const rangeProgress = ((progress - prevTarget) / (milestone.target - prevTarget)) * 100;
                    fillEl.style.width = Math.min(rangeProgress, 100) + '%';
                } else {
                    card.classList.remove('active', 'achieved');
                    statusEl.textContent = 'ðŸ”’ LOCKED';
                    statusEl.className = 'incentive-status status-locked';
                    fillEl.style.width = '0%';
                }
            });
        }

        function updateAchievementBadge(progress) {
            const badge = document.getElementById('achievementBadge');

            if (progress >= 100) {
                badge.textContent = 'ðŸ’Ž KAIZEN MASTER!';
                badge.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)';
            } else if (progress >= 75) {
                badge.textContent = 'ðŸ¥‡ GOLD WARRIOR!';
                badge.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
            } else if (progress >= 50) {
                badge.textContent = 'ðŸ¥ˆ SILVER FIGHTER!';
                badge.style.background = 'linear-gradient(135deg, #94a3b8 0%, #64748b 100%)';
            } else if (progress >= 30) {
                badge.textContent = 'ðŸ¥‰ BRONZE STARTER!';
                badge.style.background = 'linear-gradient(135deg, #d97706 0%, #b45309 100%)';
            } else {
                badge.textContent = 'ðŸ† KEEP PUSHING!';
                badge.style.background = 'linear-gradient(135deg, #f59e0b 0%, #dc2626 100%)';
            }
        }

        function createTopItem(item, rank, maxValue) {
            const percentage = (item.total / maxValue * 100).toFixed(1);
            return `
                <div class="top-item">
                    <span class="top-item-rank">#${rank}</span>
                    <div style="flex: 1;">
                        <div class="top-item-name">${item.name}</div>
                        <div class="top-item-bar">
                            <div class="top-item-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                    <span class="top-item-value">${formatCurrency(item.total)}</span>
                </div>
            `;
        }

        async function loadDashboard() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                document.getElementById('dashboard').style.display = 'none';

                const response = await fetch(SALES_API_URL);
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const data = await response.json();

                document.getElementById('targetSales').textContent = formatCurrency(data.targetSales);
                document.getElementById('dailySales').textContent = formatCurrency(data.dailySales);
                document.getElementById('avgSales').textContent = formatCurrency(data.averageSales);
                document.getElementById('totalSales').textContent = formatCurrency(data.totalSales);

                const totalTrendEl = document.getElementById('totalTrend');
                if (data.totalSales >= data.targetSales) {
                    totalTrendEl.textContent = 'ðŸ† TARGET ACHIEVED!';
                    totalTrendEl.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                } else {
                    const achievedPercent = ((data.totalSales / data.targetSales) * 100).toFixed(1);
                    totalTrendEl.textContent = `ðŸ’Ž ${achievedPercent}% ACHIEVED`;
                    totalTrendEl.style.background = 'linear-gradient(135deg, #7c3aed 0%, #c026d3 100%)';
                }

                document.getElementById('progressPercent').textContent = data.progressPercent.toFixed(1) + '%';
                document.getElementById('remainingAmount').textContent = 
                    'Tersisa ' + formatCurrency(data.remainingToTarget);

                const dailyTrend = document.getElementById('dailyTrend');
                if (data.dailySales > data.averageSales) {
                    dailyTrend.className = 'trend-indicator trend-up';
                    dailyTrend.textContent = 'ðŸ“ˆ ABOVE AVERAGE';
                } else {
                    dailyTrend.className = 'trend-indicator trend-down';
                    dailyTrend.textContent = 'ðŸ“‰ BELOW AVERAGE';
                }

                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = Math.min(data.progressPercent, 100) + '%';

                updateKaizenMessage(data.progressPercent);
                updateIncentiveMilestones(data.progressPercent);
                updateAchievementBadge(data.progressPercent);

                const maxCategory = data.topCategories[0]?.total || 1;
                document.getElementById('topCategories').innerHTML = 
                    data.topCategories.map((item, index) => 
                        createTopItem(item, index + 1, maxCategory)
                    ).join('');

                const maxStore = data.topStores[0]?.total || 1;
                document.getElementById('topStores').innerHTML = 
                    data.topStores.map((item, index) => 
                        createTopItem(item, index + 1, maxStore)
                    ).join('');

                const now = new Date();
                document.getElementById('lastUpdate').textContent = now.toLocaleString('id-ID');

                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';

            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 
                    'âš ï¸ Error loading data: ' + error.message + '. Pastikan API URL sudah benar!';
            }
        }

        // ========================================
        // ===== PROCUREMENT DASHBOARD FUNCTIONS =====
        // ========================================

        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(num);
        }

        function filterCategoryProc() {
            const category = document.getElementById('categoryFilterProc').value;
            const filtered = category === 'ALL' ? allTrackingData : allTrackingData.filter(item => item["Category"] === category);
            renderTrackingTable(filtered);
            renderBudgetChart(filtered);
        }

        function renderTrackingTable(data) {
            const tbody = document.querySelector('#trackingTable tbody');
            
            let grandTotalPOIssued = 0;
            let grandTotalPOReceived = 0;
            let grandTotalBudget = 0;
            let grandTotalSisaBudget = 0;
            
            const regularRows = data.map(item => {
                if (item["Category"] === "GRAND TOTAL") return '';
                
                grandTotalPOIssued += parseFloat(item["PO Issued"]) || 0;
                grandTotalPOReceived += parseFloat(item["PO Received"]) || 0;
                grandTotalBudget += parseFloat(item["Budget"]) || 0;
                grandTotalSisaBudget += parseFloat(item["Sisa Budget"]) || 0;
                
                const status = item["Status"] === 'Over Budget' ? 'status-over' : 'status-ok';
                return `
                    <tr>
                        <td>${item["Category"]}</td>
                        <td>Rp ${formatNumber(item["PO Issued"])}</td>
                        <td>Rp ${formatNumber(item["PO Received"])}</td>
                        <td>Rp ${formatNumber(item["Budget"])}</td>
                        <td>Rp ${formatNumber(item["Sisa Budget"])}</td>
                        <td>${item["% Used"]}%</td>
                        <td><span class="${status}">${item["Status"]}</span></td>
                    </tr>
                `;
            }).join('');
            
            const grandTotalPercentUsed = grandTotalBudget > 0 ? 
                ((grandTotalPOIssued / grandTotalBudget) * 100).toFixed(1) : 0;
            
            const grandTotalStatus = grandTotalSisaBudget < 0 ? 'status-over' : 'status-ok';
            const grandTotalStatusText = grandTotalSisaBudget < 0 ? 'Over Budget' : 'On Track';
            
            const grandTotalRow = `
                <tr class="grand-total-row">
                    <td>ðŸ“Š GRAND TOTAL</td>
                    <td>Rp ${formatNumber(grandTotalPOIssued)}</td>
                    <td>Rp ${formatNumber(grandTotalPOReceived)}</td>
                    <td>Rp ${formatNumber(grandTotalBudget)}</td>
                    <td>Rp ${formatNumber(grandTotalSisaBudget)}</td>
                    <td>${grandTotalPercentUsed}%</td>
                    <td><span class="${grandTotalStatus}">${grandTotalStatusText}</span></td>
                </tr>
            `;
            
            tbody.innerHTML = regularRows + grandTotalRow;
        }

        function renderBudgetChart(data) {
            const ctx = document.getElementById('budgetChart').getContext('2d');

            if (budgetChart) {
                budgetChart.destroy();
            }

            const chartData = data.filter(item => item["Category"] !== "GRAND TOTAL");

            budgetChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item["Category"]),
                    datasets: [
                        {
                            label: 'Budget',
                            data: chartData.map(item => item["Budget"]),
                            backgroundColor: 'rgba(37, 99, 235, 0.2)',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Used',
                            data: chartData.map(item => item["PO Issued"]),
                            backgroundColor: 'rgba(220, 38, 38, 0.2)',
                            borderColor: 'rgba(220, 38, 38, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Remaining',
                            data: chartData.map(item => item["Sisa Budget"]),
                            backgroundColor: 'rgba(34, 197, 94, 0.2)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#1e40af'
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#1e40af',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(37, 99, 235, 0.1)'
                            },
                            ticks: {
                                color: '#1e40af',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return 'Rp ' + formatNumber(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        async function loadTracking() {
            try {
                const response = await fetch(PROCUREMENT_API_URL);
                if (!response.ok) throw new Error('Failed to fetch procurement data');
                
                allTrackingData = await response.json();

                const categories = ['ALL', ...new Set(allTrackingData
                    .filter(item => item["Category"] !== "GRAND TOTAL")
                    .map(item => item["Category"]))];
                
                const categoryFilter = document.getElementById('categoryFilterProc');
                categoryFilter.innerHTML = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');

                renderTrackingTable(allTrackingData);
                renderBudgetChart(allTrackingData);

                const now = new Date();
                document.getElementById('lastUpdated').textContent = 'Terakhir update: ' + now.toLocaleString('id-ID');

            } catch (error) {
                console.error('Error loading procurement data:', error);
                alert('âš ï¸ Error loading procurement data: ' + error.message);
            }
        }

        // ========================================
        // ===== SLA SUPPLIER FUNCTIONS =====
        // ========================================

        async function checkAPIConnectionSLA() {
            try {
                updateAPIStatusGlobal('checking', 'Checking API...');
                
                const response = await fetch(`${API_URL_SLA}?action=test`, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });

                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    isAPIConnectedSLA = true;
                    updateAPIStatusGlobal('connected', 'API Connected');
                    loadAllDataSLA();
                } else {
                    throw new Error('API test failed');
                }
            } catch (error) {
                console.error('API Connection Error:', error);
                isAPIConnectedSLA = false;
                updateAPIStatusGlobal('disconnected', 'API Disconnected');
                showErrorSLA('Gagal terhubung ke API SLA', 
                    'Pastikan Google Apps Script sudah di-deploy sebagai Web App dengan akses "Anyone". ' +
                    'Error: ' + error.message
                );
            }
        }

        async function loadAllDataSLA() {
            try {
                showLoadingSLA();
                setButtonsDisabledSLA(true);

                const [storeResponse, apdResponse] = await Promise.all([
                    fetch(`${API_URL_SLA}?action=getPivotData&sheetType=STORE`),
                    fetch(`${API_URL_SLA}?action=getPivotData&sheetType=APD`)
                ]);

                if (!storeResponse.ok || !apdResponse.ok) {
                    throw new Error('HTTP Error: ' + (storeResponse.status || apdResponse.status));
                }

                const storeResult = await storeResponse.json();
                const apdResult = await apdResponse.json();

                if (storeResult.success && apdResult.success) {
                    allDataStore = storeResult.data || [];
                    allDataAPD = apdResult.data || [];
                    
                    currentDataSLA = [...allDataStore, ...allDataAPD];
                    renderTableSLA(currentDataSLA);
                    updateStatisticsSLA(currentDataSLA);
                    updateLastUpdateGlobal();
                } else {
                    throw new Error(storeResult.message || apdResult.message || 'Failed to load data');
                }
            } catch (error) {
                console.error('Error:', error);
                showErrorSLA('Gagal memuat data', error.message);
            } finally {
                setButtonsDisabledSLA(false);
            }
        }

        async function applyFilterSLA() {
            if (!isAPIConnectedSLA) {
                alert('API belum terhubung. Silakan refresh halaman.');
                return;
            }

            try {
                showLoadingSLA();
                setButtonsDisabledSLA(true);

                const categoryFilter = document.getElementById('categoryFilter').value;
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;

                let filteredData = [];

                if (dateFrom || dateTo) {
                    if (categoryFilter === 'ALL') {
                        const [storeResponse, apdResponse] = await Promise.all([
                            fetch(`${API_URL_SLA}?action=getPivotData&sheetType=STORE&dateFrom=${dateFrom}&dateTo=${dateTo}`),
                            fetch(`${API_URL_SLA}?action=getPivotData&sheetType=APD&dateFrom=${dateFrom}&dateTo=${dateTo}`)
                        ]);

                        const storeResult = await storeResponse.json();
                        const apdResult = await apdResponse.json();

                        if (storeResult.success && apdResult.success) {
                            filteredData = [...(storeResult.data || []), ...(apdResult.data || [])];
                        } else {
                            throw new Error('Filter failed');
                        }
                    } else if (categoryFilter === 'STORE') {
                        const response = await fetch(`${API_URL_SLA}?action=getPivotData&sheetType=STORE&dateFrom=${dateFrom}&dateTo=${dateTo}`);
                        const result = await response.json();
                        
                        if (!result.success) throw new Error(result.message);
                        filteredData = result.data || [];
                    } else if (categoryFilter === 'APD') {
                        const response = await fetch(`${API_URL_SLA}?action=getPivotData&sheetType=APD&dateFrom=${dateFrom}&dateTo=${dateTo}`);
                        const result = await response.json();
                        
                        if (!result.success) throw new Error(result.message);
                        filteredData = result.data || [];
                    }
                } else {
                    if (categoryFilter === 'ALL') {
                        filteredData = [...allDataStore, ...allDataAPD];
                    } else if (categoryFilter === 'STORE') {
                        filteredData = [...allDataStore];
                    } else if (categoryFilter === 'APD') {
                        filteredData = [...allDataAPD];
                    }
                }

                currentDataSLA = filteredData;
                renderTableSLA(currentDataSLA);
                updateStatisticsSLA(currentDataSLA);

            } catch (error) {
                console.error('Error:', error);
                showErrorSLA('Gagal memfilter data', error.message);
            } finally {
                setButtonsDisabledSLA(false);
            }
        }

        function resetFilterSLA() {
            document.getElementById('categoryFilter').value = 'ALL';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';

            currentDataSLA = [...allDataStore, ...allDataAPD];
            renderTableSLA(currentDataSLA);
            updateStatisticsSLA(currentDataSLA);
        }

        function updateStatisticsSLA(data) {
            if (!data || data.length === 0) {
                document.getElementById('totalPOIssued').textContent = 'Rp 0';
                document.getElementById('totalPOReceived').textContent = 'Rp 0';
                document.getElementById('averageSLA').textContent = '0%';
                document.getElementById('totalData').textContent = '0';
                return;
            }

            let totalPOIssued = 0;
            let totalPOReceived = 0;
            let totalSLA = 0;

            data.forEach(item => {
                totalPOIssued += item.poIssued || 0;
                totalPOReceived += item.poReceived || 0;
                totalSLA += item.sla || 0;
            });

            const averageSLA = data.length > 0 ? totalSLA / data.length : 0;

            document.getElementById('totalPOIssued').textContent = formatCurrency(totalPOIssued);
            document.getElementById('totalPOReceived').textContent = formatCurrency(totalPOReceived);
            document.getElementById('averageSLA').textContent = averageSLA.toFixed(2) + '%';
            document.getElementById('totalData').textContent = data.length;
        }

        function parseDateDDMMYYYY(dateStr) {
            if (!dateStr || typeof dateStr !== 'string') return null;
            
            const parts = dateStr.split('/');
            if (parts.length !== 3) return null;
            
            const day = parseInt(parts[0]);
            const month = parseInt(parts[1]);
            const year = parseInt(parts[2]);
            
            if (isNaN(day) || isNaN(month) || isNaN(year)) return null;
            if (day < 1 || day > 31 || month < 1 || month > 12) return null;
            
            return new Date(year, month - 1, day);
        }

        function sortTableSLA(column) {
            if (sortColumnSLA === column) {
                sortDirectionSLA = sortDirectionSLA === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumnSLA = column;
                sortDirectionSLA = 'asc';
            }

            const sorted = [...currentDataSLA].sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                if (column === 'tanggal') {
                    const dateA = parseDateDDMMYYYY(valA);
                    const dateB = parseDateDDMMYYYY(valB);
                    
                    if (dateA && dateB) {
                        if (sortDirectionSLA === 'asc') {
                            return dateA - dateB;
                        } else {
                            return dateB - dateA;
                        }
                    }
                }

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (sortDirectionSLA === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });

            renderTableSLA(sorted);
        }

        function renderTableSLA(data) {
            const container = document.getElementById('tableContainerSLA');

            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Tidak ada data</h3>
                        <p>Silakan sesuaikan filter Anda</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th class="text-center">NO</th>
                                <th class="sortable" onclick="sortTableSLA('supplier')">SUPPLIER</th>
                                <th class="sortable" onclick="sortTableSLA('contract')">CONTRACT</th>
                                <th class="sortable" onclick="sortTableSLA('tanggal')">TANGGAL</th>
                                <th class="sortable text-right" onclick="sortTableSLA('poIssued')">PO ISSUED</th>
                                <th class="sortable text-right" onclick="sortTableSLA('poReceived')">PO RECEIVED</th>
                                <th class="sortable text-center" onclick="sortTableSLA('sla')">SLA (%)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach((item, index) => {
                const slaClass = getSLAClass(item.sla);
                
                tableHTML += `
                    <tr>
                        <td class="table-number text-center">${index + 1}</td>
                        <td class="table-supplier">${escapeHtml(item.supplier)}</td>
                        <td class="table-contract">${escapeHtml(item.contract)}</td>
                        <td>${escapeHtml(item.tanggal)}</td>
                        <td class="table-amount text-right">${formatCurrency(item.poIssued)}</td>
                        <td class="table-amount text-right">${formatCurrency(item.poReceived)}</td>
                        <td class="text-center">
                            <span class="sla-badge ${slaClass}">${item.sla.toFixed(2)}%</span>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = tableHTML;
            updateSortIndicatorsSLA();
        }

        function updateSortIndicatorsSLA() {
            document.querySelectorAll('#tableContainerSLA th.sortable').forEach(th => {
                th.classList.remove('asc', 'desc');
            });

            if (sortColumnSLA) {
                const headers = ['supplier', 'contract', 'tanggal', 'poIssued', 'poReceived', 'sla'];
                const index = headers.indexOf(sortColumnSLA);
                if (index !== -1) {
                    const th = document.querySelectorAll('#tableContainerSLA th.sortable')[index];
                    if (th) {
                        th.classList.add(sortDirectionSLA);
                    }
                }
            }
        }

        function searchTableSLA() {
            const searchTerm = document.getElementById('searchInputSLA').value.toLowerCase();
            
            if (!searchTerm) {
                renderTableSLA(currentDataSLA);
                return;
            }

            const filtered = currentDataSLA.filter(item => {
                return item.supplier.toLowerCase().includes(searchTerm) ||
                       item.contract.toLowerCase().includes(searchTerm) ||
                       item.tanggal.includes(searchTerm);
            });

            renderTableSLA(filtered);
        }

        function showLoadingSLA() {
            document.getElementById('tableContainerSLA').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Memuat data...</div>
                </div>
            `;
        }

        function showErrorSLA(title, message) {
            document.getElementById('tableContainerSLA').innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="error-details">
                        <h4>${title}</h4>
                        <p>${message}</p>
                        <p style="margin-top: 12px;">
                            <strong>Troubleshooting:</strong><br>
                            1. Pastikan Apps Script sudah di-deploy sebagai Web App<br>
                            2. Set permission: <code>Who has access = Anyone</code><br>
                            3. Copy URL deployment baru ke file HTML<br>
                            4. Cek Browser Console (F12) untuk detail error
                        </p>
                    </div>
                </div>
            `;
        }

        function setButtonsDisabledSLA(disabled) {
            document.getElementById('btnFilter').disabled = disabled;
            document.getElementById('btnReset').disabled = disabled;
        }

        // ========================================
        // ===== STOCK ON HAND (SOH) FUNCTIONS =====
        // ========================================

        async function loadDashboardSOH() {
            try {
                await Promise.all([
                    loadSummarySOH(),
                    loadZeroStock()
                ]);
                
                isAPIConnectedSOH = true;
                updateAPIStatusGlobal('connected', 'API Connected');
                updateLastUpdateGlobal();
            } catch (error) {
                isAPIConnectedSOH = false;
                updateAPIStatusGlobal('disconnected', 'API Disconnected');
                showErrorSOH('Gagal memuat dashboard: ' + error.message);
            }
        }

        async function loadSummarySOH() {
            try {
                const response = await fetch(`${API_URL_SOH}?action=getSummary`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    document.getElementById('totalValue').textContent = formatCurrency(data.overall.totalValue);
                    document.getElementById('storeValue').textContent = formatCurrency(data.store.totalValue);
                    document.getElementById('storeItems').innerHTML = `<i class="fas fa-box"></i><span>${formatNumber(data.store.totalItems)} items</span>`;
                    document.getElementById('apdValue').textContent = formatCurrency(data.apd.totalValue);
                    document.getElementById('apdItems').innerHTML = `<i class="fas fa-box"></i><span>${formatNumber(data.apd.totalItems)} items</span>`;
                    
                    updateZeroStockCount(data);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error loading summary:', error);
                throw error;
            }
        }

        function updateZeroStockCount(data) {
            let zeroStockCount = 0;
            let subtitle = '';
            
            if (currentLocationFilter === 'all') {
                zeroStockCount = data.overall.zeroStockItems;
                subtitle = 'Active & Hold Order items (Semua Lokasi)';
            } else if (currentLocationFilter === 'store') {
                zeroStockCount = data.store.zeroStockItems || 0;
                subtitle = 'Active & Hold Order items (Store)';
            } else if (currentLocationFilter === 'apd') {
                zeroStockCount = data.apd.zeroStockItems || 0;
                subtitle = 'Active & Hold Order items (APD)';
            }
            
            document.getElementById('zeroStockCount').textContent = formatNumber(zeroStockCount);
            document.getElementById('zeroStockSubtitle').innerHTML = `<i class="fas fa-exclamation-circle"></i><span>${subtitle}</span>`;
        }

        async function loadZeroStock() {
            try {
                const type = currentLocationFilter;
                const response = await fetch(`${API_URL_SOH}?action=getZeroStock&type=${type}`);
                const result = await response.json();
                
                if (result.success) {
                    zeroStockData = result.data.filter(item => {
                        const statusUpper = item.status.toUpperCase();
                        return statusUpper === 'ACTIVE' || statusUpper === 'HOLD ORDER';
                    });
                    
                    renderZeroStockTable(zeroStockData);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error loading zero stock:', error);
                document.getElementById('zeroStockContent').innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="error-details">
                            <h4>Error</h4>
                            <p>${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        function applyFiltersSOH() {
            currentLocationFilter = document.getElementById('locationFilter').value;
            loadDashboardSOH();
        }

        function renderZeroStockTable(data) {
            const container = document.getElementById('zeroStockContent');
            const badge = document.getElementById('zeroStockBadge');
            
            badge.textContent = `${data.length} Items`;
            
            if (data.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-check-circle"></i>
                        Tidak ada item dengan stock 0 (Active & Hold Order)
                    </div>
                `;
                return;
            }

            let html = `
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th><i class="fas fa-hashtag"></i> SKU Number</th>
                                <th><i class="fas fa-box"></i> Description</th>
                                <th><i class="fas fa-info-circle"></i> Status</th>
                                <th><i class="fas fa-map-marker-alt"></i> Location</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach(item => {
                const locationClass = item.location.toLowerCase() === 'store' ? 'location-store' : 'location-apd';
                const statusClass = getStatusClass(item.status);
                const locationIcon = item.location.toLowerCase() === 'store' ? 'fa-store' : 'fa-warehouse';

                html += `
                    <tr>
                        <td class="table-sku"><strong>${escapeHtml(item.skuNumber)}</strong></td>
                        <td>${escapeHtml(item.description)}</td>
                        <td><span class="status-badge ${statusClass}">${escapeHtml(item.status)}</span></td>
                        <td><span class="location-badge ${locationClass}"><i class="fas ${locationIcon}"></i> ${escapeHtml(item.location)}</span></td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        function exportZeroStock() {
            if (zeroStockData.length === 0) {
                alert('Tidak ada data untuk di-export');
                return;
            }

            let csv = 'SKU Number,Description,Status,Location\n';
            
            zeroStockData.forEach(item => {
                csv += `"${item.skuNumber}","${item.description}","${item.status}","${item.location}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
            const locationText = currentLocationFilter === 'all' ? 'All' : 
                                 currentLocationFilter === 'store' ? 'Store' : 'APD';
            
            link.setAttribute('href', url);
            link.setAttribute('download', `Zero_Stock_${locationText}_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showErrorSOH(message) {
            document.getElementById('zeroStockContent').innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="error-details">
                        <h4>Error</h4>
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }

        // ===== HELPER FUNCTIONS =====
        function updateLastUpdateGlobal() {
            const now = new Date();
            const formatted = now.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdateGlobal').textContent = formatted;
        }

        function updateAPIStatusGlobal(status, text) {
            const badge = document.getElementById('apiStatusGlobal');
            badge.className = 'api-status ' + status;
            
            let icon = '<i class="fas fa-circle-notch fa-spin"></i>';
            if (status === 'connected') {
                icon = '<i class="fas fa-check-circle"></i>';
            } else if (status === 'disconnected') {
                icon = '<i class="fas fa-exclamation-circle"></i>';
            }
            
            badge.innerHTML = icon + ' ' + text;
        }

        function getSLAClass(sla) {
            if (sla >= 80) return 'sla-excellent';
            if (sla >= 50) return 'sla-good';
            return 'sla-poor';
        }

        function getStatusClass(status) {
            const statusUpper = status.toUpperCase();
            if (statusUpper === 'ACTIVE') return 'status-active';
            if (statusUpper === 'HOLD ORDER') return 'status-hold';
            if (statusUpper === 'DISCONTINUE') return 'status-discontinue';
            return 'status-other';
        }

        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // ===== INIT ON LOAD =====
        document.addEventListener('DOMContentLoaded', function() {
            // Load Sales dashboard by default
            loadDashboard();
        });
    </script>
</body>
</html>
